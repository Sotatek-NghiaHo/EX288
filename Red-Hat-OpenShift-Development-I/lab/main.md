## 2.11 Lab: Podman Basics
Use Podman to manage local containers.

Outcomes

- You should be able to:

- Manage local containers.

- Copy files in and out of containers.

- Run a set of application containers that connect to one another via a Podman network.

- Forward a port from a container so that it is accessible from the host machine.


Use the ls command inside of the container to verify that the container contains the `/etc/secret-file` file.
```
[student@workstation ~]$ podman exec basics-podman-secret ls /etc/secret-file
/etc/secret-file
```

Copy the `/etc/secret-file` file from the container as the solution file in the /`home/student/DO188/labs/basics-podma`n directory.
```
[student@workstation basics-podman]$ podman cp \
  basics-podman-secret:/etc/secret-file solution
[student@workstation basics-podman]$ ls
index.html  solution
```
Start a new container with the following parameters:

- Name: `basics-podman-server`

- Image: `registry.ocp4.example.com:8443/ubi9/httpd-24`

- Ports: Route traffic from port `8080` on your machine to port `8080` inside of the container

- Network: `lab-net`

You can start the container in the detached mode for greater convenience.

Create the lab-net Podman network.
```
[student@workstation ~]$ podman network create lab-net
lab-net
```
The next objective of the lab script is passing.

Execute the podman run command to start the container.
```
[student@workstation basics-podman]$ podman run -d --name basics-podman-server \
  --net lab-net -p 8080:8080 registry.ocp4.example.com:8443/ubi9/httpd-24
8b747...3616
````

3. Copy the `/home/student/DO188/labs/basics-podman/index.html` file to `/var/www/html/` in the `basics-podman-server` container.

Verify that you are in the correct directory.
```
[student@workstation basics-podman]$ ls
index.html  solution
```
Copy the index.html file in to the container.
```
[student@workstation basics-podman]$ podman cp index.html \
  basics-podman-server:/var/www/html/
```
In a web browser, go to http://localhost:8080 and verify that you see the Hello from Podman Basics lab text.

---
# 3.5 Lab: Container Images


Build the Containerfile with the `registry.ocp4.example.com:8443/developer/images-lab` container image name.
```
[student@workstation images-lab]$ podman build --file Containerfile \
  --tag registry.ocp4.example.com:8443/developer/images-lab
```

| Option   | Vi·∫øt t·∫Øt | √ù nghƒ©a                                        | N·∫øu b·ªè qua                                                                |
| -------- | -------- | ---------------------------------------------- | ------------------------------------------------------------------------- |
| `--file` | `-f`     | Ch·ªâ ƒë·ªãnh file build (Containerfile/Dockerfile) | Podman s·∫Ω t·ª± t√¨m `Containerfile` ho·∫∑c `Dockerfile` trong th∆∞ m·ª•c hi·ªán t·∫°i |
| `--tag`  | `-t`     | G·∫Øn nh√£n (t√™n + tag) cho image sau khi build   | Image s·∫Ω b·ªã g·∫Øn `<none>` l√†m t√™n v√† tag, kh√≥ qu·∫£n l√Ω                      |

Push the image to the `registry.ocp4.example.com:8443` registry.
```
[student@workstation images-lab]$ podman push \
  registry.ocp4.example.com:8443/developer/images-lab
...output omitted...
Writing manifest to image destination
```

Add the grue tag to the image.
```
[student@workstation images-lab]$ podman tag \
  registry.ocp4.example.com:8443/developer/images-lab \
  registry.ocp4.example.com:8443/developer/images-lab:grue
no output expected
```
‚û°Ô∏è H√†nh ƒë·ªông c·ªßa l·ªánh:

- podman t√¨m image c√≥ tag registry.ocp4.example.com:8443/developer/images-lab

- Sau ƒë√≥ g√°n th√™m tag m·ªõi l√† registry.ocp4.example.com:8443/developer/images-lab:grue

- Kh√¥ng copy d·ªØ li·ªáu, kh√¥ng t·∫°o image m·ªõi, ch·ªâ th√™m metadata.

üîç Ki·ªÉm tra sau khi tag:

Ch·∫°y:
```
podman images
```

B·∫°n s·∫Ω th·∫•y hai d√≤ng kh√°c nhau v·ªÅ t√™n tag, nh∆∞ng chung IMAGE ID:
```
REPOSITORY                                   TAG      IMAGE ID       CREATED          SIZE
registry.ocp4.example.com:8443/developer/images-lab      latest   a1b2c3d4e5f6   10 minutes ago   250 MB
registry.ocp4.example.com:8443/developer/images-lab      grue     a1b2c3d4e5f6   10 minutes ago   250 MB
```

üî∏ C·∫£ hai ƒë·ªÅu tr·ªè ƒë·∫øn c√πng IMAGE ID (a1b2c3d4e5f6)
üî∏ Ch·ªâ l√† hai t√™n kh√°c nhau cho c√πng m·ªôt image

üîπ N·∫øu b·∫°n xo√° m·ªôt tag:

V√≠ d·ª•:
```
podman rmi registry.ocp4.example.com:8443/developer/images-lab:grue
```

‚û°Ô∏è Ch·ªâ xo√° tag "grue", image v·∫´n c√≤n v√¨ c√≤n tag kh√°c (latest).

Ch·ªâ khi xo√° h·∫øt t·∫•t c·∫£ tag tr·ªè ƒë·∫øn image ƒë√≥, th√¨ Podman m·ªõi xo√° image th·ª±c t·∫ø kh·ªèi local.

‚úÖ T√≥m l·∫°i:

- `podman tag `= th√™m m·ªôt "b√≠ danh" (alias) cho image ‚Üí kh√¥ng t·∫°o image m·ªõi
- Image c≈© v·∫´n c√≤n nguy√™n
- C√°c tag ƒë·ªÅu tr·ªè t·ªõi c√πng IMAGE ID


---

# 4.7 Lab: Custom Container Images
Complete the Containerfile for an application that generates a QR code from a given text.

Outcomes
- You should be able to:
- Understand multistage builds.
- Run commands within a container.
- Set environment variables.
- Set a working directory.
- Set an entry point.
- Change the user that executes commands.

Containerfile ban dau
```
FROM \
  registry.ocp4.example.com:8443/redhattraining/podman-certificate-generator \
  as certs

FROM registry.ocp4.example.com:8443/ubi9/nodejs-22:1
USER root
RUN groupadd -r student && useradd -r -m -g student student && \
    npm config set cache /tmp/.npm --global

COPY --from=certs --chown=student:student /app/*.pem /etc/pki/tls/private/certs/
COPY --chown=student:student . /app/
```

Task  
2. In the build stage of the Containerfile, generate the TLS certificates by using the `./gen_certificates.sh` command.

The `./gen_certificates.sh` command is included in the provided container.

3. In the final stage of the Containerfile, set the following environment variables:

- TLS_PORT=8443 (the port for TLS traffic)
- HTTP_PORT=8080 (the port for HTTP traffic)
- CERTS_PATH=/etc/pki/tls/private/certs (the path that contains the TLS certificates)

4. In the final stage of the Containerfile, set the working directory of the application to the `/app` path.

Then, build the container image with the name `localhost/podman-qr-app`.

5. In the final stage of the Containerfile, set the `student` user as the user that runs the application. The `student` user exists in the Containerfile.

Then, build the container image with the name `localhost/podman-qr-app`.


6. In the final stage of the Containerfile, run the `npm install --omit=dev` command to install the production dependencies of the Node.js application.

Then, build the container image with the name `localhost/podman-qr-app`.

7. In the final stage of the Containerfile, make `npm start` the default command for this image. Additional runtime arguments should not override the default command.

Then, build the container image with the name `localhost/podman-qr-app`.

8. Start the podman-qr-app container. Call the container custom-lab and publish the container ports 8080 and 8443 to the same ports on the host.

Use the podman run command to start the application and bind the corresponding ports.
```
[student@workstation custom-lab]$ podman run --name=custom-lab \
  -p 8080:8080 -p 8443:8443 podman-qr-app
...output omitted...
TLS Server running on port 8443
Server running on port  8080
```

- Container c√≥ port 8080 s·∫Ω ƒë∆∞·ª£c √°nh x·∫° ra port 8080 c·ªßa host

- Container c√≥ port 8443 s·∫Ω ƒë∆∞·ª£c √°nh x·∫° ra port 8443 c·ªßa host

‚úÖ K·∫øt qu·∫£: b·∫°n c√≥ th·ªÉ truy c·∫≠p ·ª©ng d·ª•ng t·ª´ b√™n ngo√†i container th√¥ng qua:
```
http://localhost:8080

https://localhost:8443
```
√ù nghƒ©a c·ªßa t√πy ch·ªçn -p hostPort:containerPort

T√πy ch·ªçn `-p` (vi·∫øt t·∫Øt c·ªßa --publish) d√πng ƒë·ªÉ √°nh x·∫° (map) c·ªïng tr√™n container ra c·ªïng tr√™n m√°y host.
C√∫ ph√°p l√†:
```
-p <host_port>:<container_port>
```

Final 
```
FROM \
  registry.ocp4.example.com:8443/redhattraining/podman-certificate-generator \
  as certs

RUN ./gen_certificates.sh

FROM registry.ocp4.example.com:8443/ubi9/nodejs-22:1
USER root
RUN groupadd -r student && useradd -r -m -g student student && \
    npm config set cache /tmp/.npm --global

COPY --from=certs --chown=student:student /app/*.pem /etc/pki/tls/private/certs/
COPY --chown=student:student . /app/

ENV TLS_PORT=8443 \
    HTTP_PORT=8080 \
    CERTS_PATH="/etc/pki/tls/private/certs"

WORKDIR /app

USER student

RUN npm install --omit=dev

ENTRYPOINT npm start
```

üß± So s√°nh t·ªïng th·ªÉ: RUN vs CMD vs ENTRYPOINT

| L·ªánh           | Th·ª±c thi khi n√†o             | M·ª•c ƒë√≠ch                                                                     | C√≥ trong container runtime kh√¥ng?          | C√≥ b·ªã ghi ƒë√® kh√¥ng?                             |
| -------------- | ---------------------------- | ---------------------------------------------------------------------------- | ------------------------------------------ | ----------------------------------------------- |
| **RUN**        | üî® **Trong l√∫c build image** | Th·ª±c thi m·ªôt l·ªánh **ƒë·ªÉ thay ƒë·ªïi image** (vd: c√†i g√≥i, copy file, build code) | ‚ùå Kh√¥ng (ch·ªâ ƒë·ªÉ t·∫°o layer m·ªõi trong image) | Kh√¥ng c·∫ßn                                       |
| **CMD**        | ‚ñ∂Ô∏è **Khi container ch·∫°y**    | Ch·ªâ ƒë·ªãnh **l·ªánh m·∫∑c ƒë·ªãnh** ƒë·ªÉ container ch·∫°y n·∫øu user kh√¥ng truy·ªÅn g√¨ th√™m   | ‚úÖ C√≥                                       | ‚úÖ C√≥ th·ªÉ ghi ƒë√®                                 |
| **ENTRYPOINT** | ‚ñ∂Ô∏è **Khi container ch·∫°y**    | Ch·ªâ ƒë·ªãnh **ch∆∞∆°ng tr√¨nh ch√≠nh b·∫Øt bu·ªôc** m√† container s·∫Ω ch·∫°y                | ‚úÖ C√≥                                       | ‚ùå Kh√¥ng b·ªã ghi ƒë√® (tr·ª´ khi d√πng `--entrypoint`) |

Note: M·ªói l·ªánh `RUN` t·∫°o ra m·ªôt layer m·ªõi trong image ‚Üí ch·ª©a k·∫øt qu·∫£ c·ªßa l·ªánh ƒë√≥ (file, config, binary,...).

üîπ CMD (runtime default command)

Ch·∫°y khi container kh·ªüi ƒë·ªông, n·∫øu b·∫°n kh√¥ng truy·ªÅn g√¨ th√™m.
V√≠ d·ª•:
```
CMD ["npm", "start"]
```

Khi b·∫°n ch·∫°y `podman run myimage`, container s·∫Ω ch·∫°y `npm start`

N·∫øu b·∫°n ch·∫°y `podman run myimage bash`, bash s·∫Ω ghi ƒë√® CMD

üß† T√≥m l·∫°i: CMD l√† runtime, l√† l·ªánh m·∫∑c ƒë·ªãnh c√≥ th·ªÉ b·ªã ghi ƒë√®

üîπ `ENTRYPOINT` (runtime main command)

Lu√¥n ch·∫°y khi container kh·ªüi ƒë·ªông, kh√¥ng b·ªã ghi ƒë√® tr·ª´ khi b·∫°n ch·ªâ ƒë·ªãnh `--entrypoint`.
V√≠ d·ª•:
```
ENTRYPOINT ["npm", "start"]
```

D√π b·∫°n ch·∫°y:
```
podman run myimage bash
```

‚Üí v·∫´n ch·∫°y `npm start`, kh√¥ng ch·∫°y bash

N·∫øu mu·ªën ch·∫°y bash, b·∫°n ph·∫£i d√πng:
```
podman run --entrypoint bash myimage
```

üß† T√≥m l·∫°i: ENTRYPOINT l√† runtime, l√† ch∆∞∆°ng tr√¨nh ch√≠nh b·∫Øt bu·ªôc

---

# 5.5 Lab: Persisting Data

Create a named volume with the following parameters:

- The volume is called postgres-vol.

- The volume contains the contents of the /home/student/DO188/labs/persisting-lab/postgres-vol.tar.gz file.

Create the volume.
```
[student@workstation ~]$ podman volume create postgres-vol
postgres-vol
```
Import the `/home/student/DO188/labs/persisting-lab/postgres-vol.tar.gz` file to the volume:
```
[student@workstation ~]$ podman volume import postgres-vol \
  ~/DO188/labs/persisting-lab/postgres-vol.tar.gz
...no output expected...
```
üß± 1. podman volume create t·∫°o ra volume ·ªü c·∫•p host, kh√¥ng ph·∫£i trong container

Khi b·∫°n ch·∫°y:
```
podman volume create postgres-vol
```

‚û°Ô∏è Podman s·∫Ω t·∫°o m·ªôt named volume (volume c√≥ t√™n) t√™n l√† postgres-vol.

Volume n√†y:

- Kh√¥ng n·∫±m trong container, m√† n·∫±m tr√™n host (·ªü th∆∞ m·ª•c do Podman qu·∫£n l√Ω, v√≠ d·ª• /var/lib/containers/storage/volumes/postgres-vol/_data)

- L√† m·ªôt storage ƒë·ªôc l·∫≠p, b·ªÅn v·ªØng (persistent)

- D√πng ƒë·ªÉ l∆∞u d·ªØ li·ªáu m√† b·∫°n mu·ªën gi·ªØ l·∫°i d√π container b·ªã x√≥a

üì¶ 2. podman volume import l√† n·∫°p d·ªØ li·ªáu v√†o volume ƒë√≥
```
podman volume import postgres-vol ~/DO188/labs/persisting-lab/postgres-vol.tar.gz
```

‚û°Ô∏è L·ªánh n√†y gi·∫£i n√©n n·ªôi dung c·ªßa file postgres-vol.tar.gz v√†o th∆∞ m·ª•c d·ªØ li·ªáu c·ªßa volume postgres-vol.

C·ª• th·ªÉ:

- File .tar.gz n√†y ch·ª©a m·ªôt s·ªë file (v√≠ d·ª• database dump, c·∫•u h√¨nh)

- Podman s·∫Ω unpack v√†o b√™n trong /var/lib/containers/storage/volumes/postgres-vol/_data

Kh√¥ng c√≥ output n√†o (‚úÖ ƒë√∫ng nh∆∞ ƒë·ªÅ n√≥i ‚Äúno output expected‚Äù).

üîπ Hai c√°ch t∆∞∆°ng ƒë∆∞∆°ng

C√°ch 1 ‚Äî D√πng c√∫ ph√°p ‚Äúng·∫Øn‚Äù -v:
```
podman run --name persisting-db -d \
  --net persisting-net \
  -e POSTGRESQL_USER=user \
  -e POSTGRESQL_PASSWORD=pass \
  -e POSTGRESQL_DATABASE=db \
  -v postgres-vol:/var/lib/pgsql/data \
  registry.ocp4.example.com:8443/rhel9/postgresql-13:1
```

C√°ch 2 ‚Äî D√πng c√∫ ph√°p ‚Äúd√†i‚Äù --mount:
```
podman run --name persisting-db -d \
  --net persisting-net \
  -e POSTGRESQL_USER=user \
  -e POSTGRESQL_PASSWORD=pass \
  -e POSTGRESQL_DATABASE=db \
  --mount type=volume,src=postgres-vol,dst=/var/lib/pgsql/data \
  registry.ocp4.example.com:8443/rhel9/postgresql-13:1
```

üëâ Hai l·ªánh tr√™n k·∫øt qu·∫£ ho√†n to√†n nh∆∞ nhau.


--mount='type=volume,src=postgre-vol,dst=/var/lib/pgsql/data'

---
# 6.5 Lab: Troubleshooting Containers

Troubleshoot the quotes-api application.

The application consists of the following components:

- The quotes-api-v1 service with the v1 quotes API version.

- The quotes-api-v2 service with the v2 quotes API version.

- The quotes-ui service, which accepts the quotes API version as an environment variable.

The quotes-ui container starts an NGINX proxy that performs the following tasks:

- Serves the web application.

- Acts as a reverse proxy to route the UI requests to the version specified in the QUOTES_API_VERSION environment variable.

Outcomes

- You should be able to:

- Check container logs.

- Run container commands.

- Troubleshoot container networking problems.

- Configure containers by using environment variables.

- Configure containers by overriding container configuration files with host files.

üß© 1. M·ª•c ti√™u c·ªßa task

B·∫°n c√≥ 3 container c·∫ßn ch·∫°y song song v√† c√≥ th·ªÉ giao ti·∫øp v·ªõi nhau:

| Container       | ·∫¢nh                            | Ghi ch√∫                                                          |
| --------------- | ------------------------------ | ---------------------------------------------------------------- |
| `quotes-api-v1` | `.../wiremock`                 | API gi·∫£ l·∫≠p version 1                                            |
| `quotes-api-v2` | `.../wiremock`                 | API gi·∫£ l·∫≠p version 2                                            |
| `quotes-ui`     | `.../quotes-ui-versioning:1.0` | ·ª®ng d·ª•ng frontend (Nginx) g·ªçi `quotes-api-v1` v√† `quotes-api-v2` |


‚öôÔ∏è 2. C·∫•u h√¨nh mong mu·ªën

quotes-ui l√† frontend reverse proxy Nginx, n√≥ c√≥ c·∫•u h√¨nh nh∆∞ sau:
```
proxy_pass http://quotes-api-v1
```

v√†
```
proxy_pass http://quotes-api-v2
```

üí° Nghƒ©a l√†: trong file c·∫•u h√¨nh, Nginx s·∫Ω t√¨m hostname quotes-api-v1 v√† quotes-api-v2 ƒë·ªÉ g·ª≠i request.

‚Üí V√¨ v·∫≠y, Nginx c·∫ßn c√≥ kh·∫£ nƒÉng resolve (tra IP) c√°c hostname ƒë√≥.

‚ùå 3. V·∫•n ƒë·ªÅ ban ƒë·∫ßu

Container quotes-ui b·ªã l·ªói:
```
nginx: [emerg] host not found in upstream "quotes-api-v1" in /etc/nginx/nginx.conf:45
```

T·ª©c l√†:

‚ö†Ô∏è quotes-ui kh√¥ng th·ªÉ t√¨m th·∫•y hostname quotes-api-v1 ‚Üí Nginx kh·ªüi ƒë·ªông th·∫•t b·∫°i ‚Üí container b·ªã Exited.

üîç 4. ƒêi·ªÅu tra nguy√™n nh√¢n

B·∫°n d√πng podman inspect ƒë·ªÉ xem container ƒëang ·ªü network n√†o.

quotes-api-v1:
```
map[troubleshooting-lab:0xc000a825a0]
```

quotes-api-v2:
```
map[troubleshooting-lab:0xc000a825a0]
```

quotes-ui:
```
map[pasta:0xc0006cd200]
```

üß† Ph√¢n t√≠ch:

- Hai API (v1, v2) ƒëang ·ªü network `troubleshooting-lab`

- `quotes-ui` l·∫°i ·ªü network `pasta` (network m·∫∑c ƒë·ªãnh)

‚û°Ô∏è K·∫øt qu·∫£: quotes-ui v√† quotes-api-v1/v2 kh√¥ng c√πng m·∫°ng ‚Üí kh√¥ng th·ªÉ ping ho·∫∑c resolve t√™n hostname c·ªßa nhau.

‚úÖ 5. Gi·∫£i ph√°p

C√°ch duy nh·∫•t ƒë·ªÉ container giao ti·∫øp qua t√™n hostname l√†:

‚öôÔ∏è Ch√∫ng ph·∫£i ·ªü c√πng m·ªôt Podman network.

V√¨ v·∫≠y, b·∫°n xo√° container c≈©:
```
podman rm quotes-ui
```

R·ªìi ch·∫°y l·∫°i v·ªõi network ƒë√∫ng:
```
podman run -d \
  --name quotes-ui -p 3000:8080 \
  -e QUOTES_API_VERSION=v2 \
  --net troubleshooting-lab \
  registry.ocp4.example.com:8443/redhattraining/quotes-ui-versioning:1.0
```

‚û°Ô∏è quotes-ui gi·ªù c√πng network troubleshooting-lab v·ªõi quotes-api-v1 v√† quotes-api-v2  
‚û°Ô∏è Nginx c√≥ th·ªÉ resolve hostname ‚Üí kh·ªüi ƒë·ªông th√†nh c√¥ng ‚úÖ

---

üß≠ 1. C√∫ ph√°p t·ªïng qu√°t
```
podman inspect [T√äN ho·∫∑c ID] [--format M·∫™U]
```

üîç D√πng ƒë·ªÉ xem th√¥ng tin chi ti·∫øt c·ªßa:

- container

- image

- volume

- network

üß± 2. Inspect container 
üîπ Xem to√†n b·ªô c·∫•u h√¨nh container:
```
podman inspect quotes-ui
```

‚û°Ô∏è In ra JSON chi ti·∫øt g·ªìm:

- T√™n, ID, Image

- M√¥i tr∆∞·ªùng (env)

- C·ªïng (ports)

- M·∫°ng (networks)

- Volume mount

- User, Entrypoint, CMD

- Tr·∫°ng th√°i hi·ªán t·∫°i

üîπ L·ªçc th√¥ng tin b·∫±ng --format

D√πng Go template ƒë·ªÉ l·ªçc g·ªçn th√¥ng tin.

V√≠ d·ª•:

| M·ª•c ƒë√≠ch                            | L·ªánh                                                                | K·∫øt qu·∫£              |
| ----------------------------------- | ------------------------------------------------------------------- | -------------------- |
| Xem container ƒëang d√πng network n√†o | `podman inspect quotes-ui --format '{{.NetworkSettings.Networks}}'` | Hi·ªÉn th·ªã map network |
| Xem image c·ªßa container             | `podman inspect quotes-ui --format '{{.ImageName}}'`                | T√™n image            |
| Xem port mapping                    | `podman inspect quotes-ui --format '{{.NetworkSettings.Ports}}'`    | Danh s√°ch port       |
| Xem environment variables           | `podman inspect quotes-ui --format '{{.Config.Env}}'`               | Bi·∫øn m√¥i tr∆∞·ªùng      |

üì¶ 3. Inspect image
```
podman inspect localhost/podman-qr-app
```

‚û°Ô∏è Th√¥ng tin v·ªÅ:

- Entrypoint, CMD

- Layers

- Env, ExposedPorts

- Labels

üíæ 4. Inspect volume
```
podman volume inspect postgres-vol
```

‚û°Ô∏è Cho bi·∫øt:

- T√™n volume

- Driver

- Mountpoint (v·ªã tr√≠ tr√™n host)

- Dung l∆∞·ª£ng (n·∫øu c√≥)

üìò V√≠ d·ª•:
```
[
  {
    "Name": "postgres-vol",
    "Driver": "local",
    "Mountpoint": "/var/lib/containers/storage/volumes/postgres-vol/_data"
  }
]
```
üåê 5. Inspect network
```
podman network inspect troubleshooting-lab
```

‚û°Ô∏è Cho bi·∫øt:

- T√™n network

- Subnet, Gateway

- Lo·∫°i network (bridge, pasta, host)

- Container n√†o ƒëang tham gia

üìò V√≠ d·ª•:
```
[
  {
    "Name": "troubleshooting-lab",
    "Driver": "bridge",
    "Subnets": [
      {
        "Subnet": "10.89.0.0/24",
        "Gateway": "10.89.0.1"
      }
    ],
    "Containers": {
      "quotes-api-v1": {
        "IPv4Address": "10.89.0.2/24"
      },
      "quotes-ui": {
        "IPv4Address": "10.89.0.3/24"
      }
    }
  }
]
```

üìã 6. Xem danh s√°ch hi·ªán c√≥

| M·ª•c        | L·ªánh                | Gi·∫£i th√≠ch        |
| ---------- | ------------------- | ----------------- |
| Containers | `podman ps -a`      | T·∫•t c·∫£ container  |
| Images     | `podman images`     | Danh s√°ch image   |
| Volumes    | `podman volume ls`  | Danh s√°ch volume  |
| Networks   | `podman network ls` | Danh s√°ch network |

üß© T√≥m t·∫Øt nhanh

| M·ª•c ƒë√≠ch          | L·ªánh                               |
| ----------------- | ---------------------------------- |
| Inspect container | `podman inspect <container>`       |
| Inspect image     | `podman inspect <image>`           |
| Inspect volume    | `podman volume inspect <volume>`   |
| Inspect network   | `podman network inspect <network>` |
| Li·ªát k√™ volume    | `podman volume ls`                 |
| Li·ªát k√™ network   | `podman network ls`                |


```
server {
    listen 8080;

    location /api/v1 {
        rewrite /api/v1/(.*) /$1 break;
        proxy_pass http://quotes-api-v1:8080;
    }

    location /api/v2 {
        rewrite /api/v2/(.*) /$1 break;
        proxy_pass http://quotes-api-v2:8081;
    }

    location / {
        root /usr/share/nginx/html;
    }
}

```

![alt text](image.png)

| Ng∆∞·ªùi d√πng truy c·∫≠p (host)            | B√™n trong `quotes-ui` | H√†nh ƒë·ªông th·ª±c hi·ªán                                 |
| ------------------------------------- | --------------------- | --------------------------------------------------- |
| `http://localhost:3000`               | `/`                   | Tr·∫£ v·ªÅ file tƒ©nh (HTML, JS, UI app)                 |
| `http://localhost:3000/api/v1/quotes` | `/api/v1/quotes`      | Proxy t·ªõi `http://quotes-api-v1:8080/api/v1/quotes` |
| `http://localhost:3000/api/v2/quotes` | `/api/v2/quotes`      | Proxy t·ªõi `http://quotes-api-v2:8081/api/v2/quotes` |


---

# 7.5 Lab: Multi-container Applications with Compose
Create a compose file to deploy your application in a testing environment. The application uses three components: a UI, a back end, and an external service that the back end uses. Because the development team does not own the external service, they decided to use a mock server called Wiremock to mock the external service interactions with the back end.

Outcomes

You should be able to:

- Create a multi-container compose file with the following features:

  - Bind mounts

  - Environment variables

  - Networks

  - Published ports

- Reload the compose file after modifying it.


![alt text](image-1.png)

```
name: compose-lab

services:
  wiremock:
    container_name: "quotes-provider"
    image: "registry.ocp4.example.com:8443/redhattraining/wiremock"
    volumes:
      - ~/DO188/labs/compose-lab/wiremock/stubs:/home/wiremock:Z
    networks:
      - backend-net
  quotes-api:
    container_name: "quotes-api"
    image: "registry.ocp4.example.com:8443/redhattraining/podman-quotesapi-compose"
    networks:
      - backend-net
      - frontend-net
    environment:
      QUOTES_SERVICE: "http://quotes-provider:8080"
  quotes-ui:
    container_name: "quotes-ui"
    image: "registry.ocp4.example.com:8443/redhattraining/podman-quotes-ui"
    networks:
    - frontend-net
    ports:
      - "3000:8080"

networks:
  backend-net: {}
  frontend-net: {}
```
üîÅ T·ªïng s∆° ƒë·ªì lu·ªìng
```
[User/Host:3000] 
   ‚Üì
quotes-ui:8080  (frontend-net)
   ‚Üì (calls http://quotes-api:8080)
quotes-api:8080 (frontend-net + backend-net)
   ‚Üì (calls http://quotes-provider:8080)
quotes-provider:8080 (wiremock, backend-net)
```

‚úÖ T√≥m t·∫Øt ch·ª©c nƒÉng t·ª´ng th√†nh ph·∫ßn

| Service                      | Vai tr√≤        | M·∫°ng tham gia             | Port host | Li√™n k·∫øt ƒë·∫øn      |
| ---------------------------- | -------------- | ------------------------- | --------- | ----------------- |
| `quotes-ui`                  | Frontend web   | frontend-net              | 3000:8080 | `quotes-api`      |
| `quotes-api`                 | API trung gian | backend-net, frontend-net | ‚ùå         | `quotes-provider` |
| `quotes-provider` (wiremock) | Fake backend   | backend-net               | ‚ùå         | ‚Äî                 |


üß© 1. C√≥ b·∫Øt bu·ªôc ph·∫£i c√≥ d·∫•u " quanh gi√° tr·ªã nh∆∞ "http://quotes-provider:8080" kh√¥ng?

‚û°Ô∏è Kh√¥ng b·∫Øt bu·ªôc, nh∆∞ng r·∫•t n√™n c√≥ trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p.

üîπ Khi c√≥ th·ªÉ b·ªè d·∫•u ngo·∫∑c

N·∫øu gi√° tr·ªã l√† m·ªôt chu·ªói b√¨nh th∆∞·ªùng (kh√¥ng c√≥ k√Ω t·ª± ƒë·∫∑c bi·ªát), b·∫°n c√≥ th·ªÉ vi·∫øt:
```
environment:
  QUOTES_SERVICE: http://quotes-provider:8080
```

YAML s·∫Ω hi·ªÉu ƒë√¢y l√† m·ªôt chu·ªói (string).

üîπ Khi n√™n gi·ªØ d·∫•u ngo·∫∑c k√©p " "

M·ªôt s·ªë k√Ω t·ª± trong YAML c√≥ nghƒ©a ƒë·∫∑c bi·ªát, v√≠ d·ª•:
```
:, #, {}, [], &, *, ?, !, %, @
```
ho·∫∑c gi√° tr·ªã c√≥ d·∫•u c√°ch, k√Ω t·ª± ƒë·∫∑c bi·ªát, ho·∫∑c true, no, on, off (v√¨ YAML c√≥ th·ªÉ hi·ªÉu sai th√†nh boolean)

C·ª• th·ªÉ:
```
QUOTES_SERVICE: http://quotes-provider:8080   # ‚úÖ h·ª£p l·ªá
PASSWORD: abc:123                            # ‚ùå l·ªói c√∫ ph√°p (v√¨ c√≥ d·∫•u :)
PASSWORD: "abc:123"                          # ‚úÖ an to√†n
```

üü¢ T√≥m l·∫°i:

D·∫•u ngo·∫∑c k√©p " " kh√¥ng b·∫Øt bu·ªôc, nh∆∞ng n√™n d√πng khi c√≥ k√Ω t·ª± ƒë·∫∑c bi·ªát nh∆∞ d·∫•u :
‚Üí ƒë·ªÉ YAML kh√¥ng hi·ªÉu sai c·∫•u tr√∫c.

üí° Nguy√™n nh√¢n: YAML ph√¢n bi·ªát danh s√°ch (list) v√† b·∫£n ƒë·ªì (mapping)

Trong YAML, kh√¥ng ph·∫£i c·ª© ‚Äúc√≥ nhi·ªÅu th·ª©‚Äù l√† ph·∫£i d√πng s·ªë nhi·ªÅu ‚Äî
m√† quan tr·ªçng l√† ki·ªÉu d·ªØ li·ªáu m√† key ƒë√≥ ch·ª©a.

üîπ environment: l√† m·ªôt mapping (b·∫£n ƒë·ªì)

N√≥ l√† m·ªôt t·∫≠p h·ª£p key‚Äìvalue, ch·ª© kh√¥ng ph·∫£i danh s√°ch c√°c m·ª•c ri√™ng l·∫ª.
=> Do ƒë√≥ d√πng s·ªë √≠t.

V√≠ d·ª•:
```
environment:
  APP_ENV: production
  DB_USER: user1
  DB_PASS: secret
```

ho·∫∑c d·∫°ng danh s√°ch (t∆∞∆°ng ƒë∆∞∆°ng):
```
environment:
  - APP_ENV=production
  - DB_USER=user1
  - DB_PASS=secret
```

‚û°Ô∏è D√π c√≥ nhi·ªÅu bi·∫øn, nh∆∞ng t·∫•t c·∫£ c√πng n·∫±m trong m·ªôt c·∫•u tr√∫c duy nh·∫•t
g·ªçi l√† environment mapping, n√™n YAML gi·ªØ key l√† s·ªë √≠t (environment).

üîπ networks: v√† ports: l·∫°i l√† danh s√°ch (list)

M·ªói m·ª•c (- something) l√† m·ªôt ph·∫ßn t·ª≠ ri√™ng bi·ªát, kh√¥ng c√≥ c·∫∑p key‚Äìvalue c·ªë ƒë·ªãnh.
=> Do ƒë√≥ d√πng s·ªë nhi·ªÅu.

V√≠ d·ª•:
```
networks:
  - backend-net
  - frontend-net

ports:
  - "3000:8080"
  - "8443:8443"
```

·ªû ƒë√¢y YAML hi·ªÉu l√† m·ªôt list c√°c gi√° tr·ªã, n√™n Docker/Podman Compose ƒë·∫∑t t√™n l√† s·ªë nhi·ªÅu.

üî∏ So s√°nh tr·ª±c quan

| Key            | Ki·ªÉu d·ªØ li·ªáu        | V√≠ d·ª•            | Ghi ch√∫                  |
| -------------- | ------------------- | ---------------- | ------------------------ |
| `environment:` | mapping (key‚Äìvalue) | `DB_USER: user`  | M·ªôt kh·ªëi ch·ª©a nhi·ªÅu bi·∫øn |
| `ports:`       | list                | `- "8080:80"`    | Danh s√°ch c√°c port       |
| `volumes:`     | list                | `- ./data:/data` | Danh s√°ch mount          |
| `networks:`    | list                | `- frontend`     | Danh s√°ch network        |

üîπ V√¨ sao v·∫´n l√† ‚Äús·ªë √≠t‚Äù?

B·ªüi v√¨ environment ch·ªâ l√† m·ªôt ph·∫ßn t·ª≠ duy nh·∫•t trong service:
```
services:
  web:
    image: nginx
    environment:   # <-- ƒë√¢y l√† 1 kh·ªëi duy nh·∫•t
      VAR1: one
      VAR2: two
```

Docker Compose kh√¥ng xem m·ªói bi·∫øn l√† m·ªôt c·∫•u tr√∫c ri√™ng (n·∫øu v·∫≠y th√¨ n√≥ m·ªõi g·ªçi l√† environments:).
N√≥ ch·ªâ xem environment: l√† m·ªôt nh√≥m key‚Äìvalue, ƒë∆∞·ª£c x·ª≠ l√Ω c√πng l√∫c.


Th·ª≠ tr∆∞·ªõc b·∫±ng l·ªánh:
```
podman-compose config
```

‚Üí Ki·ªÉm tra xem file c√≥ h·ª£p l·ªá kh√¥ng (n√≥ s·∫Ω hi·ªÉn th·ªã b·∫£n d·ªãch th√†nh JSON).

---
# 8.5 Lab: Container Orchestration with Kubernetes and OpenShift
Debug and deploy a multi-container application to the Red Hat OpenShift Container Platform (RHOCP).

**Outcomes**   
You should be able to:

- Verify and correct the configuration of the Service and Deployment RHOCP objects.
- Deploy RHOCP objects.



![alt text](image-2.png)

![alt text](image-3.png)

![alt text](image-4.png)

```
oc rsh deploy/quotes-ui
curl http://quotes-api:8080
```


![alt text](image-5.png)

üß© T√≥m t·∫Øt workfollow

Khi b·∫°n truy c·∫≠p t·ª´ b√™n ngo√†i cluster:
```
Client (browser)
 ‚Üì
Route (Ingress)
 ‚Üì
Service quotes-ui
 ‚Üì
Pod quotes-ui (ch·∫°y NGINX)
 ‚Üì
Service quotes-api (DNS n·ªôi b·ªô: quotes-api:8080)
 ‚Üì
Pod quotes-api
```
















